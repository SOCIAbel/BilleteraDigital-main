<div class="container">

  <div class="header">
    <h2>Categorías</h2>

    <!-- Botón AGREGAR -->
    <button mat-raised-button color="primary" (click)="openDialog()">
      + Agregar
    </button>
  </div>

  <!-- DIALOGO INTERNO (SIN OTRO COMPONENTE) -->
  <ng-template #dialogTemplate>
    <h2 mat-dialog-title>Nueva Categoría</h2>

    <div mat-dialog-content>

      <mat-form-field appearance="outline" class="field">
        <mat-label>Nombre</mat-label>
        <input matInput [(ngModel)]="form.name">
      </mat-form-field>

      <mat-form-field appearance="outline" class="field">
        <mat-label>Ícono</mat-label>
        <input matInput [(ngModel)]="form.icon" placeholder="shopping, food, home">
      </mat-form-field>

      <mat-form-field appearance="outline" class="field">
        <mat-label>Color</mat-label>
        <input matInput type="color" [(ngModel)]="form.color">
      </mat-form-field>

    </div>

    <div mat-dialog-actions align="end">
      <button mat-button (click)="dialogRef.close()">Cancelar</button>
      <button mat-raised-button color="primary" (click)="saveCategory()">Guardar</button>
    </div>
  </ng-template>

  <!-- TABLA -->
  <table mat-table [dataSource]="categories" class="mat-elevation-z8 table">

    <!-- ID -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let c">{{ c.id }}</td>
    </ng-container>

    <!-- Nombre -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let c">{{ c.name }}</td>
    </ng-container>

    <!-- Icono -->
    <ng-container matColumnDef="icon">
      <th mat-header-cell *matHeaderCellDef>Icono</th>
      <td mat-cell *matCellDef="let c">{{ c.icon }}</td>
    </ng-container>

    <!-- Color -->
    <ng-container matColumnDef="color">
      <th mat-header-cell *matHeaderCellDef>Color</th>
      <td mat-cell *matCellDef="let c">
        <span class="color-box" [style.background]="c.color"></span>
        {{ c.color }}
      </td>
    </ng-container>

    <!-- Fecha -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let c">{{ c.createdAt | date:'short' }}</td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let c">

        <!-- ⭐ BOTÓN SUBCATEGORÍAS AÑADIDO ⭐ -->
       <button class="action sub" (click)="irASubcategorias(c.id)">
  Subcategorías
</button>


        <button class="action update" (click)="openEditDialog(c)">Actualizar</button>
        <button class="action delete" (click)="deleteCategory(c.id)">Eliminar</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

  </table>

</div>

<router-outlet></router-outlet>
